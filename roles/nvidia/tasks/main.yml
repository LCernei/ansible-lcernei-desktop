---
# tasks file for nvidia
- name: Check if nouveau is blacklisted
  stat:
    path: /etc/modprobe.d/blacklist-nvidia-nouveau.conf
  register: nouveau_blacklisted
  changed_when: no

- name: Install ToolBoox
  block:
    - name: Create blacklist file
      copy:
        mode: '0644'
        dest: /etc/modprobe.d/blacklist-nvidia-nouveau.conf
        content: |
          blacklist nouveau
          options nouveau modeset=0
    - name: Update initramfs
      command: update-initramfs -u
  become: yes
  when: not nouveau_blacklisted.stat.exists
